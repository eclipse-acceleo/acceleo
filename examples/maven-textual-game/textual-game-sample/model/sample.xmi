<?xml version="1.0" encoding="UTF-8"?>
<textualgame:Game
    xmi:version="2.0"
    xmlns:xmi="http://www.omg.org/XMI"
    xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"
    xmlns:textualgame="http://www.eclipse.org/acceleo/textualgame"
    initialRoom="//@rooms.0"
    initialItems="//@items.0">
  <rooms name="firstRoom"
      defaultState="//@rooms.0/@states.0">
    <states
        name="default"
        description="You enter a room with two doors."
        image="images/firstRoom.png"/>
    <actions
        xsi:type="textualgame:GotoRoom"
        name="take the left door"
        room="//@rooms.1"/>
    <actions
        xsi:type="textualgame:GotoRoom"
        name="take the right door"
        room="//@rooms.2"/>
  </rooms>
  <rooms name="torchRoom"
      defaultState="//@rooms.1/@states.0">
    <states
        name="default"
        description="You enter a small room lit up by torches on the walls."
        image="images/torchRoom.png"/>
    <actions
        xsi:type="textualgame:GotoRoom"
        name="go back"
        room="//@rooms.0"/>
    <actions
        xsi:type="textualgame:AddItemsToInventory"
        name="grab a torch"
        description="You grab a torch, and take it off the wall."
        isOneTime="true"
        items="//@items.3"/>
  </rooms>
  <rooms name="corridorRoom"
      defaultState="//@rooms.2/@states.0">
    <states
        name="default"
        description="You enter a long corridor, with a door at the end and a door on the left side. You also notice a ladder to the left."
        image="images/corridorRoom.png"/>
    <actions
        xsi:type="textualgame:GotoRoom"
        name="go back"
        room="//@rooms.0"/>
    <actions
        xsi:type="textualgame:GotoRoom"
        name="take the left door"
        room="//@rooms.5"/>
    <actions
        xsi:type="textualgame:GotoRoom"
        name="take the door at the end"
        room="//@rooms.4"/>
    <actions
        xsi:type="textualgame:GotoRoom"
        name="take the ladder"
        room="//@rooms.3"/>
  </rooms>
  <rooms name="exitDoorRoom"
      defaultState="//@rooms.3/@states.0">
    <states
        name="default"
        description="You enter a room with a single door. The door is locked, and you can see two different keyholes in the door: a red one and a green one."
        image="images/exitDoorRoom.png"/>
    <states
        name="usedOneKey"
        description="You enter a room with a single door. The door is locked, and you can see two different keyholes in the door: a red one and a green one. You used a key, but the door is still locked."
        image="images/exitDoorRoom.png">
      <isActive
          xsi:type="textualgame:InRoomState"
          roomState="//@rooms.3/@states.1"/>
    </states>
    <states
        name="usedTwoKeys"
        description="You enter a room with a single door. Now that you used your two keys, the door is unlocked!"
        image="images/exitDoorRoom.png">
      <isActive
          xsi:type="textualgame:InRoomState"
          roomState="//@rooms.3/@states.2"/>
    </states>
    <actions
        xsi:type="textualgame:GotoRoom"
        name="go back"
        room="//@rooms.2"/>
    <actions
        xsi:type="textualgame:GotoRoom"
        name="open the door"
        room="//@rooms.6">
      <isEnabled
          xsi:type="textualgame:InRoomState"
          roomState="//@rooms.3/@states.2"/>
    </actions>
  </rooms>
  <rooms name="chestRoom"
      defaultState="//@rooms.4/@states.0">
    <states
        name="default"
        description="It's an empty room with a small blue chest."
        image="images/chestRoom.png"/>
    <actions
        xsi:type="textualgame:GotoRoom"
        name="go back"
        room="//@rooms.2"/>
  </rooms>
  <rooms name="greenKeyRoom"
      defaultState="//@rooms.5/@states.0">
    <states
        name="default"
        description="The room is soo dark you cannot see anything."
        image="images/greenKeyRoom_black.png"/>
    <states
        name="lit"
        description="You can see inside the dark room with your torch, and you notice a key on the ground."
        image="images/greenKeyRoom_lit.png">
      <isActive
          xsi:type="textualgame:HasItems"
          items="//@items.3"/>
    </states>
    <actions
        xsi:type="textualgame:GotoRoom"
        name="go back"
        room="//@rooms.2"/>
    <actions
        xsi:type="textualgame:AddItemsToInventory"
        name="inspect the ground"
        description="You grab the green key on the ground."
        isOneTime="true"
        items="//@items.1">
      <isVisible
          xsi:type="textualgame:InRoomState"
          roomState="//@rooms.5/@states.1"/>
    </actions>
  </rooms>
  <rooms name="exitRoom"
      defaultState="//@rooms.6/@states.0">
    <states
        name="default"
        description="You opened the door with the two keys, and reached the exit of the maze!"
        image="images/exitRoom.png"/>
    <actions
        xsi:type="textualgame:Restart"
        name="restart"/>
  </rooms>
  <items name="blue key"
      description="A strange key you found in your pocket.">
    <actions
        xsi:type="textualgame:AddItemsToInventory"
        name="Use"
        description="You use the key to open the chest, and you find a red key inside."
        items="//@items.2">
      <isEnabled
          xsi:type="textualgame:InRoom"
          room="//@rooms.4"/>
    </actions>
  </items>
  <items name="green key"
      description="A strange key you found on the ground.">
    <actions
        xsi:type="textualgame:AddItemsToInventory"
        name="Use"
        items="//@items.1">
      <isEnabled
          xsi:type="textualgame:InRoom"
          room="//@rooms.3"/>
    </actions>
  </items>
  <items name="red key"
      description="A shiny red key you found in a chest.">
    <actions
        xsi:type="textualgame:AddItemsToInventory"
        name="Use"
        items="//@items.2">
      <isEnabled
          xsi:type="textualgame:InRoom"
          room="//@rooms.3"/>
    </actions>
  </items>
  <items name="torch"
      description="A torch."/>
</textualgame:Game>
